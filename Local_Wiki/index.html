<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Wiki</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #222;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        header {
            background: #fff;
            border-bottom: 1px solid #a2a9b1;
            padding: 0.5rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0645ad;
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        button {
            padding: 0.5rem 1rem;
            border: 1px solid #a2a9b1;
            background: #f8f9fa;
            cursor: pointer;
            border-radius: 2px;
            font-size: 0.9rem;
        }

        button:hover {
            background: #e8f4fd;
        }

        .primary-btn {
            background: #0645ad;
            color: white;
            border-color: #0645ad;
        }

        .primary-btn:hover {
            background: #0b0080;
        }

        .search-box {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        input[type="text"] {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #a2a9b1;
            border-radius: 2px;
            font-size: 1rem;
        }

        .content {
            padding: 1rem 2rem;
        }

        .page-title {
            font-size: 2rem;
            border-bottom: 3px solid #a2a9b1;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            color: #000;
        }

        .editor {
            display: none;
        }

        .editor textarea {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            border: 1px solid #a2a9b1;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .editor-buttons {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .wiki-content h1 { font-size: 1.8rem; margin: 1.5rem 0 1rem; border-bottom: 1px solid #a2a9b1; padding-bottom: 0.3rem; }
        .wiki-content h2 { font-size: 1.5rem; margin: 1.3rem 0 0.8rem; border-bottom: 1px solid #a2a9b1; padding-bottom: 0.2rem; }
        .wiki-content h3 { font-size: 1.3rem; margin: 1.1rem 0 0.6rem; }
        .wiki-content h4 { font-size: 1.1rem; margin: 1rem 0 0.5rem; font-weight: bold; }
        .wiki-content h5 { font-size: 1rem; margin: 0.9rem 0 0.4rem; font-weight: bold; }
        .wiki-content h6 { font-size: 0.9rem; margin: 0.8rem 0 0.3rem; font-weight: bold; }

        .wiki-content p {
            margin-bottom: 1rem;
        }

        .wiki-content ul, .wiki-content ol {
            margin: 1rem 0 1rem 2rem;
        }

        .wiki-content li {
            margin-bottom: 0.3rem;
        }

        .wiki-content blockquote {
            border-left: 4px solid #a2a9b1;
            margin: 1rem 0;
            padding-left: 1rem;
            color: #555;
        }

        .wiki-content code {
            background: #f6f6f6;
            padding: 0.2rem 0.4rem;
            border-radius: 2px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .wiki-content pre {
            background: #f6f6f6;
            padding: 1rem;
            border-radius: 2px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .wiki-content pre code {
            background: none;
            padding: 0;
        }

        .wiki-content a {
            color: #0645ad;
            text-decoration: none;
        }

        .wiki-content a:hover {
            text-decoration: underline;
        }

        .wiki-content a.new {
            color: #ba0000;
        }

        .wiki-content strong {
            font-weight: bold;
        }

        .wiki-content em {
            font-style: italic;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 1rem;
            margin-top: 2rem;
            border: 1px solid #a2a9b1;
            border-radius: 2px;
        }

        .sidebar h3 {
            margin-top: 0;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .page-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .page-list li {
            margin-bottom: 0.3rem;
        }

        .page-list a {
            color: #0645ad;
            text-decoration: none;
        }

        .page-list a:hover {
            text-decoration: underline;
        }

        .help-text {
            background: #f0f8ff;
            border: 1px solid #a2a9b1;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 2px;
            font-size: 0.9rem;
        }

        .help-text h4 {
            margin-top: 0;
            color: #0645ad;
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">ðŸ“š Local Wiki</div>
                <div class="nav-buttons">
                    <button id="newPageBtn">New Page</button>
                    <button id="editBtn">Edit</button>
                    <button id="deleteBtn">Delete</button>
                    <button id="historyBtn">All Pages</button>
                    <button id="pageHistoryBtn">Page History</button>
                    <button id="helpBtn">Help</button>
                    <button id="exportBtn">Export Data</button>
                    <button id="importBtn">Import Data</button>
                </div>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search or enter page name...">
                <button id="searchBtn">Go</button>
            </div>
        </header>

        <div class="content">
            <div id="viewer">
                <h1 class="page-title" id="pageTitle">Welcome to Local Wiki</h1>
                <div class="wiki-content" id="pageContent">
                    <div class="empty-state">
                        <p>Welcome to your personal wiki! This wiki supports Wikipedia-style markup and stores everything locally in your browser.</p>
                        <p>Click "New Page" to create your first page, or "Help" to learn about the markup syntax.</p>
                    </div>
                </div>
            </div>

            <div id="editor" class="editor">
                <h1 class="page-title" id="editorTitle">Editing Page</h1>
                <textarea id="editorTextarea" placeholder="Enter your wiki content here using Wikipedia markup..."></textarea>
                <div class="editor-buttons">
                    <button id="saveBtn" class="primary-btn">Save Page</button>
                    <button id="cancelBtn">Cancel</button>
                    <button id="previewBtn">Preview</button>
                </div>
            </div>

            <div class="sidebar">
                <h3 id="sidebarTitle">All Pages</h3>
                <ul class="page-list" id="pageList">
                    <li class="empty-state">No pages yet</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class Wiki {
            constructor() {
    this.currentPage = 'Main Page';
    this.isEditing = false;
    this.initializeElements();
    this.bindEvents();
    this.loadPage(this.currentPage);    // Add this line
    this.updatePageList();              // Add this line
}
    
            initializeElements() {
                this.viewer = document.getElementById('viewer');
                this.editor = document.getElementById('editor');
                this.pageTitle = document.getElementById('pageTitle');
                this.pageContent = document.getElementById('pageContent');
                this.editorTitle = document.getElementById('editorTitle');
                this.editorTextarea = document.getElementById('editorTextarea');
                this.searchInput = document.getElementById('searchInput');
                this.pageList = document.getElementById('pageList');
                this.sidebarTitle = document.getElementById('sidebarTitle');
            }

            bindEvents() {
                document.getElementById('newPageBtn').addEventListener('click', () => this.newPage());
                document.getElementById('editBtn').addEventListener('click', () => this.editPage());
                document.getElementById('deleteBtn').addEventListener('click', () => this.deletePage());
                document.getElementById('saveBtn').addEventListener('click', () => this.savePage());
                document.getElementById('cancelBtn').addEventListener('click', () => this.cancelEdit());
                document.getElementById('previewBtn').addEventListener('click', () => this.previewPage());
                document.getElementById('searchBtn').addEventListener('click', () => this.searchPage());
                document.getElementById('historyBtn').addEventListener('click', () => this.showAllPages());
                document.getElementById('helpBtn').addEventListener('click', () => this.showHelp());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportData());
                document.getElementById('importBtn').addEventListener('click', () => this.importData());
                
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchPage();
                });

                // Handle internal links
                document.addEventListener('click', (e) => {
                    if (e.target.matches('a[href^="#"]')) {
                        e.preventDefault();
                        const pageName = e.target.getAttribute('href').substring(1);
                        this.loadPage(pageName);
                    }
                });

                // Handle browser back/forward (only if served over HTTP/HTTPS)
                if (window.location.protocol !== 'file:') {
                    window.addEventListener('popstate', (e) => {
                        if (e.state && e.state.page) {
                            this.loadPage(e.state.page, false);
                        }
                    });
                }
            }

            getPages() {
                try {
                    const pages = localStorage.getItem('wiki_pages');
                    const result = pages ? JSON.parse(pages) : {};
                    console.log('Retrieved pages from localStorage:', Object.keys(result));
                    return result;
                } catch (error) {
                    console.error('Error reading from localStorage:', error);
                    return {};
                }
            }

            getPageHistory(pageName) {
                try {
                    const history = localStorage.getItem('wiki_history');
                    const allHistory = history ? JSON.parse(history) : {};
                    return allHistory[pageName] || [];
                } catch (error) {
                    console.error('Error reading page history:', error);
                    return [];
                }
            }

            savePageHistory(pageName, content) {
                try {
                    const history = localStorage.getItem('wiki_history');
                    const allHistory = history ? JSON.parse(history) : {};
                    
                    if (!allHistory[pageName]) {
                        allHistory[pageName] = [];
                    }
                    
                    // Add new version to history
                    allHistory[pageName].push({
                        content: content,
                        timestamp: new Date().toISOString(),
                        version: allHistory[pageName].length + 1
                    });
                    
                    // Keep only last 10 versions to prevent localStorage bloat
                    if (allHistory[pageName].length > 10) {
                        allHistory[pageName] = allHistory[pageName].slice(-10);
                        // Renumber versions
                        allHistory[pageName].forEach((entry, index) => {
                            entry.version = index + 1;
                        });
                    }
                    
                    localStorage.setItem('wiki_history', JSON.stringify(allHistory));
                } catch (error) {
                    console.error('Error saving page history:', error);
                }
            }

            savePage() {
                const content = this.editorTextarea.value;
                const pages = this.getPages();
                
                // Save to history before updating current content
                this.savePageHistory(this.currentPage, content);
                
                pages[this.currentPage] = content;
                localStorage.setItem('wiki_pages', JSON.stringify(pages));
                
                console.log('Saved page:', this.currentPage, 'Content length:', content.length);
                console.log('All pages now:', Object.keys(pages));
                
                this.isEditing = false;
                this.showViewer();
                this.loadPage(this.currentPage);
                this.updatePageList();
            }

            loadPage(pageName, updateHistory = true) {
                this.currentPage = pageName;
                const pages = this.getPages();
                const content = pages[pageName] || '';
                
                this.pageTitle.textContent = pageName;
                this.searchInput.value = pageName;
                
                // Update URL (only if served over HTTP/HTTPS, not file://)
                if (updateHistory && window.location.protocol !== 'file:') {
                    try {
                        const url = pageName === 'Main Page' ? '/' : `/articles/${encodeURIComponent(pageName)}`;
                        history.pushState({ page: pageName }, pageName, url);
                    } catch (e) {
                        // Silently fail if pushState is not supported
                        console.log('History API not available in this context');
                    }
                }
                
                // Update sidebar title
                const isSpecialPage = ['All Pages', 'Help', 'Main Page'].includes(pageName);
                this.sidebarTitle.textContent = isSpecialPage ? 'All Pages' : 'Other Pages';
                
                if (content) {
                    this.pageContent.innerHTML = this.parseWikiMarkup(content);
                } else if (pageName === 'Main Page') {
                    // Show special welcome content for Main Page when no content exists
                    this.pageContent.innerHTML = `
                        <div class="empty-state">
                            <p>Welcome to your personal wiki! This wiki supports Wikipedia-style markup and stores everything locally in your browser.</p>
                            <p>Click "New Page" to create your first page, or "Help" to learn about the markup syntax.</p>
                        </div>
                    `;
                } else {
                    this.pageContent.innerHTML = `
                        <div class="empty-state">
                            <p>Page "${pageName}" does not exist yet.</p>
                            <p><button onclick="wiki.editPage()">Create this page</button></p>
                        </div>
                    `;
                }
                
                this.showViewer();
            }

            editPage() {
                const pages = this.getPages();
                const content = pages[this.currentPage] || '';
                
                this.editorTitle.textContent = `Editing: ${this.currentPage}`;
                this.editorTextarea.value = content;
                this.isEditing = true;
                this.showEditor();
            }

            newPage() {
                const pageName = prompt('Enter the name of the new page:');
                if (pageName && pageName.trim()) {
                    this.loadPage(pageName.trim());
                    this.editPage();
                }
            }

            deletePage() {
                if (['Main Page', 'All Pages', 'Help'].includes(this.currentPage)) {
                    alert('This page cannot be deleted.');
                    return;
                }
                
                const pages = this.getPages();
                if (!pages[this.currentPage]) {
                    alert('This page does not exist.');
                    return;
                }
                
                if (confirm(`Are you sure you want to delete the page "${this.currentPage}"? This action cannot be undone.`)) {
                    delete pages[this.currentPage];
                    localStorage.setItem('wiki_pages', JSON.stringify(pages));
                    
                    // Also delete history for this page
                    try {
                        const history = localStorage.getItem('wiki_history');
                        const allHistory = history ? JSON.parse(history) : {};
                        delete allHistory[this.currentPage];
                        localStorage.setItem('wiki_history', JSON.stringify(allHistory));
                    } catch (error) {
                        console.error('Error deleting page history:', error);
                    }
                    
                    this.updatePageList();
                    this.loadPage('Main Page');
                }
            }

            cancelEdit() {
                this.isEditing = false;
                this.showViewer();
            }

            previewPage() {
                const content = this.editorTextarea.value;
                this.pageContent.innerHTML = this.parseWikiMarkup(content);
                
                // Temporarily show viewer while keeping editor state
                this.viewer.style.display = 'block';
                this.editor.style.display = 'none';
                
                setTimeout(() => {
                    this.showEditor();
                }, 100);
            }

            searchPage() {
                const pageName = this.searchInput.value.trim();
                if (pageName) {
                    this.loadPage(pageName);
                }
            }

            showViewer() {
                this.viewer.style.display = 'block';
                this.editor.style.display = 'none';
            }

            showEditor() {
                this.viewer.style.display = 'none';
                this.editor.style.display = 'block';
            }

            updatePageList() {
                const pages = this.getPages();
                const pageNames = Object.keys(pages).sort();
                
                console.log('Updating page list. Found pages:', pageNames);
                
                if (pageNames.length === 0) {
                    this.pageList.innerHTML = '<li class="empty-state">No pages yet</li>';
                } else {
                    this.pageList.innerHTML = pageNames
                        .map(name => `<li><a href="#${name}">${name}</a></li>`)
                        .join('');
                }
            }

            showAllPages() {
                const pages = this.getPages();
                const pageNames = Object.keys(pages).sort();
                
                let content = '= All Pages =\n\n';
                if (pageNames.length === 0) {
                    content += 'No pages have been created yet.';
                } else {
                    pageNames.forEach(name => {
                        content += `* [[${name}]]\n`;
                    });
                }
                
                this.loadPage('All Pages');
                this.pageContent.innerHTML = this.parseWikiMarkup(content);
            }

            showHelp() {
                const helpContent = `= Wiki Markup Help =

This wiki supports Wikipedia-style markup. Here are the main formatting options:

== Headings ==
* <code>= Level 1 =</code>
* <code>== Level 2 ==</code>
* <code>=== Level 3 ===</code>
* And so on...

== Text Formatting ==
* <code>'''bold text'''</code> â†’ '''bold text'''
* <code>''italic text''</code> â†’ ''italic text''

== Lists ==
* <code>* Bullet point</code>
* <code>** Sub-bullet</code>
* <code># Numbered list</code>
* <code>## Sub-numbered</code>

== Links ==
* <code>[[Page Name]]</code> â†’ Link to another page
* <code>[[Page Name|Display Text]]</code> â†’ Link with custom text

== Other ==
* <code>&lt;code&gt;inline code&lt;/code&gt;</code> â†’ <code>inline code</code>
* Lines starting with space create preformatted text
* Empty lines create paragraph breaks

== Example ==
<pre>
= My Page =

This is a paragraph with '''bold''' and ''italic'' text.

== Section ==
* First item
* Second item
** Sub-item

Check out [[Other Page]] for more info!
</pre>
`;
                
                this.loadPage('Help');
                this.pageContent.innerHTML = this.parseWikiMarkup(helpContent);
            }

            showPageHistory() {
                if (['All Pages', 'Help', 'Page History'].includes(this.currentPage)) {
                    alert('No history available for this page.');
                    return;
                }
                
                const history = this.getPageHistory(this.currentPage);
                
                let content = `= Page History: ${this.currentPage} =\n\n`;
                
                if (history.length === 0) {
                    content += 'No history available for this page.';
                } else {
                    content += `Found ${history.length} version${history.length === 1 ? '' : 's'}:\n\n`;
                    
                    // Show versions in reverse chronological order (newest first)
                    history.slice().reverse().forEach((version, index) => {
                        const date = new Date(version.timestamp);
                        const formattedDate = date.toLocaleString();
                        const isLatest = index === 0;
                        
                        content += `== Version ${version.version}${isLatest ? ' (Current)' : ''} ==\n`;
                        content += `'''Date:''' ${formattedDate}\n\n`;
                        content += `<details>\n`;
                        content += `<summary>View content (${version.content.length} characters)</summary>\n\n`;
                        content += `<pre>${version.content}</pre>\n`;
                        content += `</details>\n\n`;
                        
                        if (!isLatest) {
                            content += `<button onclick="wiki.restoreVersion('${this.currentPage}', ${version.version - 1})">Restore this version</button>\n\n`;
                        }
                    });
                }
                
                this.currentPage = 'Page History';
                this.pageTitle.textContent = `Page History: ${this.currentPage}`;
                this.pageContent.innerHTML = this.parseWikiMarkup(content);
                this.showViewer();
            }

            restoreVersion(pageName, versionIndex) {
                const history = this.getPageHistory(pageName);
                if (history[versionIndex]) {
                    const oldContent = history[versionIndex].content;
                    
                    if (confirm(`Restore version ${versionIndex + 1}? This will replace the current content.`)) {
                        const pages = this.getPages();
                        
                        // Save current content to history before restoring
                        this.savePageHistory(pageName, pages[pageName] || '');
                        
                        // Restore the old version
                        pages[pageName] = oldContent;
                        localStorage.setItem('wiki_pages', JSON.stringify(pages));
                        
                        // Navigate back to the restored page
                        this.loadPage(pageName);
                        alert(`Version ${versionIndex + 1} has been restored.`);
                    }
                }
            }

            exportData() {
                const pages = this.getPages();
                const dataStr = JSON.stringify(pages, null, 2);
                
                // Create download link
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'wiki-backup.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('Wiki data exported! Save the downloaded file to import into other environments.');
            }

            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const importedData = JSON.parse(e.target.result);
                                
                                // Validate the data structure
                                if (typeof importedData === 'object' && importedData !== null) {
                                    const pageCount = Object.keys(importedData).length;
                                    if (confirm(`Import ${pageCount} pages? This will merge with existing data.`)) {
                                        const currentPages = this.getPages();
                                        const mergedPages = { ...currentPages, ...importedData };
                                        localStorage.setItem('wiki_pages', JSON.stringify(mergedPages));
                                        this.updatePageList();
                                        alert(`Successfully imported ${pageCount} pages!`);
                                        this.loadPage('Main Page');
                                    }
                                } else {
                                    alert('Invalid file format. Please select a valid wiki backup file.');
                                }
                            } catch (error) {
                                alert('Error reading file: ' + error.message);
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                
                input.click();
            }

            parseWikiMarkup(text) {
                let html = text;
                
                // Escape HTML
                html = html.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                // Headings
                html = html.replace(/^======\s*(.*?)\s*======$/gm, '<h6>$1</h6>');
                html = html.replace(/^=====\s*(.*?)\s*=====$/gm, '<h5>$1</h5>');
                html = html.replace(/^====\s*(.*?)\s*====$/gm, '<h4>$1</h4>');
                html = html.replace(/^===\s*(.*?)\s*===$/gm, '<h3>$1</h3>');
                html = html.replace(/^==\s*(.*?)\s*==$/gm, '<h2>$1</h2>');
                html = html.replace(/^=\s*(.*?)\s*=$/gm, '<h1>$1</h1>');
                
                // Bold and italic
                html = html.replace(/'''(.*?)'''/g, '<strong>$1</strong>');
                html = html.replace(/''(.*?)''/g, '<em>$1</em>');
                
                // Links
                html = html.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g, (match, page, text) => {
                    const pages = this.getPages();
                    const className = pages[page] ? '' : ' class="new"';
                    return `<a href="#${page}"${className}>${text}</a>`;
                });
                
                html = html.replace(/\[\[([^\]]+)\]\]/g, (match, page) => {
                    const pages = this.getPages();
                    const className = pages[page] ? '' : ' class="new"';
                    return `<a href="#${page}"${className}>${page}</a>`;
                });
                
                // Code blocks (preformatted)
                html = html.replace(/&lt;pre&gt;([\s\S]*?)&lt;\/pre&gt;/g, '<pre><code>$1</code></pre>');
                
                // Inline code
                html = html.replace(/&lt;code&gt;(.*?)&lt;\/code&gt;/g, '<code>$1</code>');
                
                // Preformatted text (lines starting with space)
                html = html.replace(/^( .+)$/gm, '<pre><code>$1</code></pre>');
                
                // Lists
                const lines = html.split('\n');
                let inList = false;
                let listType = '';
                let listLevel = 0;
                let result = [];
                
                for (let line of lines) {
                    const bulletMatch = line.match(/^(\*+)\s*(.*)$/);
                    const numberMatch = line.match(/^(#+)\s*(.*)$/);
                    
                    if (bulletMatch) {
                        const level = bulletMatch[1].length;
                        const content = bulletMatch[2];
                        
                        if (!inList || listType !== 'ul' || level !== listLevel) {
                            if (inList) result.push('</ul>');
                            result.push('<ul>');
                            inList = true;
                            listType = 'ul';
                            listLevel = level;
                        }
                        result.push(`<li>${content}</li>`);
                    } else if (numberMatch) {
                        const level = numberMatch[1].length;
                        const content = numberMatch[2];
                        
                        if (!inList || listType !== 'ol' || level !== listLevel) {
                            if (inList) result.push('</ol>');
                            result.push('<ol>');
                            inList = true;
                            listType = 'ol';
                            listLevel = level;
                        }
                        result.push(`<li>${content}</li>`);
                    } else {
                        if (inList) {
                            result.push(listType === 'ul' ? '</ul>' : '</ol>');
                            inList = false;
                        }
                        result.push(line);
                    }
                }
                
                if (inList) {
                    result.push(listType === 'ul' ? '</ul>' : '</ol>');
                }
                
                html = result.join('\n');
                
                // Paragraphs
                html = html.replace(/\n\s*\n/g, '</p><p>');
                html = '<p>' + html + '</p>';
                
                // Clean up empty paragraphs and fix HTML structure
                html = html.replace(/<p>\s*<\/p>/g, '');
                html = html.replace(/<p>\s*(<h[1-6]>)/g, '$1');
                html = html.replace(/(<\/h[1-6]>)\s*<\/p>/g, '$1');
                html = html.replace(/<p>\s*(<ul>)/g, '$1');
                html = html.replace(/(<\/ul>)\s*<\/p>/g, '$1');
                html = html.replace(/<p>\s*(<ol>)/g, '$1');
                html = html.replace(/(<\/ol>)\s*<\/p>/g, '$1');
                html = html.replace(/<p>\s*(<pre>)/g, '$1');
                html = html.replace(/(<\/pre>)\s*<\/p>/g, '$1');
                
                return html;
            }
        }

        // Initialize the wiki
        const wiki = new Wiki();
    </script>
</body>
</html>
