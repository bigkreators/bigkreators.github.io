(function($){function submitHandler(){var a=this.formPluginId;var b=$.fn.ajaxForm.optionHash[a];$(this).ajaxSubmit(b);return false}function clickHandler(a){var b=this.form;b.clk=this;if(this.type=="image"){if(a.offsetX!=undefined){b.clk_x=a.offsetX;b.clk_y=a.offsetY}else if(typeof $.fn.offset=="function"){var c=$(this).offset();b.clk_x=a.pageX-c.left;b.clk_y=a.pageY-c.top}else{b.clk_x=a.pageX-this.offsetLeft;b.clk_y=a.pageY-this.offsetTop}}setTimeout(function(){b.clk=b.clk_x=b.clk_y=null},10)}$.fn.ajaxSubmit=function(options){function fileUpload(){function toXml(a,b){if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a)}else b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&b.documentElement.tagName!="parsererror"?b:null}function cb(){if(cbInvoked++)return;io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var ok=true;try{if(timedOut)throw"timeout";var data,doc;doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;xhr.responseText=doc.body?doc.body.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(opts.dataType=="json"||opts.dataType=="script"){var ta=doc.getElementsByTagName("textarea")[0];data=ta?ta.value:xhr.responseText;if(opts.dataType=="json")eval("data = "+data);else $.globalEval(data)}else if(opts.dataType=="xml"){data=xhr.responseXML;if(!data&&xhr.responseText!=null)data=toXml(xhr.responseText)}else{data=xhr.responseText}}catch(e){ok=false;$.handleError(opts,xhr,"error",e)}if(ok){opts.success(data,"success");if(g)$.event.trigger("ajaxSuccess",[xhr,opts])}if(g)$.event.trigger("ajaxComplete",[xhr,opts]);if(g&&!--$.active)$.event.trigger("ajaxStop");if(opts.complete)opts.complete(xhr,ok?"success":"error");setTimeout(function(){$io.remove();xhr.responseXML=null},100)}var form=$form[0];var opts=$.extend({},$.ajaxSettings,options);var id="jqFormIO"+$.fn.ajaxSubmit.counter++;var $io=$('<iframe id="'+id+'" name="'+id+'" />');var io=$io[0];var op8=$.browser.opera&&window.opera.version()<9;if($.browser.msie||op8)io.src='javascript:false;document.write("");';$io.css({position:"absolute",top:"-1000px",left:"-1000px"});var xhr={responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}};var g=opts.global;if(g&&!($.active++))$.event.trigger("ajaxStart");if(g)$.event.trigger("ajaxSend",[xhr,opts]);var cbInvoked=0;var timedOut=0;setTimeout(function(){$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false);var a=form.encoding?"encoding":"enctype";var b=$form.attr("target");$form.attr({target:id,method:"POST",action:opts.url});form[a]="multipart/form-data";if(opts.timeout)setTimeout(function(){timedOut=true;cb()},opts.timeout);form.submit();$form.attr("target",b)},10);}if(typeof options=="function")options={success:options};options=$.extend({url:this.attr("action")||window.location.toString(),type:this.attr("method")||"GET"},options||{});var veto={};$.event.trigger("form.pre.serialize",[this,options,veto]);if(veto.veto)return this;var a=this.formToArray(options.semantic);if(options.data){for(var n in options.data)a.push({name:n,value:options.data[n]})}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false)return this;$.event.trigger("form.submit.validate",[a,this,options,veto]);if(veto.veto)return this;var q=$.param(a);if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null}else options.data=q;var $form=this,callbacks=[];if(options.resetForm)callbacks.push(function(){$form.resetForm()});if(options.clearForm)callbacks.push(function(){$form.clearForm()});if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(a){if(this.evalScripts)$(options.target).attr("innerHTML",a).evalScripts().each(oldSuccess,arguments);else $(options.target).html(a).each(oldSuccess,arguments)})}else if(options.success)callbacks.push(options.success);options.success=function(a,b){for(var c=0,d=callbacks.length;c<d;c++)callbacks[c](a,b,$form)};var files=$("input:file",this).fieldValue();var found=false;for(var j=0;j<files.length;j++)if(files[j])found=true;if(options.iframe||found){if($.browser.safari&&options.closeKeepAlive)$.get(options.closeKeepAlive,fileUpload);else fileUpload()}else $.ajax(options);$.event.trigger("form.submit.notify",[this,options]);return this;};$.fn.ajaxSubmit.counter=0;$.fn.ajaxForm=function(a){return this.ajaxFormUnbind().submit(submitHandler).each(function(){this.formPluginId=$.fn.ajaxForm.counter++;$.fn.ajaxForm.optionHash[this.formPluginId]=a;$(":submit,input:image",this).click(clickHandler)})};$.fn.ajaxForm.counter=1;$.fn.ajaxForm.optionHash={};$.fn.ajaxFormUnbind=function(){this.unbind("submit",submitHandler);return this.each(function(){$(":submit,input:image",this).unbind("click",clickHandler)})};$.fn.formToArray=function(a){var b=[];if(this.length==0)return b;var c=this[0];var d=a?c.getElementsByTagName("*"):c.elements;if(!d)return b;for(var e=0,f=d.length;e<f;e++){var g=d[e];var h=g.name;if(!h)continue;if(a&&c.clk&&g.type=="image"){if(!g.disabled&&c.clk==g)b.push({name:h+".x",value:c.clk_x},{name:h+".y",value:c.clk_y});continue}var i=$.fieldValue(g,true);if(i&&i.constructor==Array){for(var j=0,k=i.length;j<k;j++)b.push({name:h,value:i[j]})}else if(i!==null&&typeof i!="undefined")b.push({name:h,value:i})}if(!a&&c.clk){var l=c.getElementsByTagName("input");for(var e=0,f=l.length;e<f;e++){var m=l[e];var h=m.name;if(h&&!m.disabled&&m.type=="image"&&c.clk==m)b.push({name:h+".x",value:c.clk_x},{name:h+".y",value:c.clk_y})}}return b};$.fn.formSerialize=function(a){return $.param(this.formToArray(a))};$.fn.fieldSerialize=function(a){var b=[];this.each(function(){var c=this.name;if(!c)return;var d=$.fieldValue(this,a);if(d&&d.constructor==Array){for(var e=0,f=d.length;e<f;e++)b.push({name:c,value:d[e]})}else if(d!==null&&typeof d!="undefined")b.push({name:this.name,value:d})});return $.param(b)};$.fn.fieldValue=function(a){for(var b=[],c=0,d=this.length;c<d;c++){var e=this[c];var f=$.fieldValue(e,a);if(f===null||typeof f=="undefined"||f.constructor==Array&&!f.length)continue;f.constructor==Array?$.merge(b,f):b.push(f)}return b};$.fieldValue=function(a,b){var c=a.name,d=a.type,e=a.tagName.toLowerCase();if(typeof b=="undefined")b=true;if(b&&(!c||a.disabled||d=="reset"||d=="button"||(d=="checkbox"||d=="radio")&&!a.checked||(d=="submit"||d=="image")&&a.form&&a.form.clk!=a||e=="select"&&a.selectedIndex==-1))return null;if(e=="select"){var f=a.selectedIndex;if(f<0)return null;var g=[],h=a.options;var i=d=="select-one";var j=i?f+1:h.length;for(var k=i?f:0;k<j;k++){var l=h[k];if(l.selected){var m=$.browser.msie&&!l.attributes["value"].specified?l.text:l.value;if(i)return m;g.push(m)}}return g}return a.value};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var a=this.type,b=this.tagName.toLowerCase();if(a=="text"||a=="password"||b=="textarea")this.value="";else if(a=="checkbox"||a=="radio")this.checked=false;else if(b=="select")this.selectedIndex=-1})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})};$.fn.enable=function(a){if(a==undefined)a=true;return this.each(function(){this.disabled=!a})};$.fn.select=function(a){if(a==undefined)a=true;return this.each(function(){var b=this.type;if(b=="checkbox"||b=="radio")this.checked=a;else if(this.tagName.toLowerCase()=="option"){var c=$(this).parent("select");if(a&&c[0]&&c[0].type=="select-one"){c.find("option").select(false)}this.selected=a}})}})(jQuery)